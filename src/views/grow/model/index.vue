<template>
  <div class="bunga-flower" v-loading="loading">
    <div
      class="bunga-flower-item"
      v-for="[key, value] in Object.entries(flowers)"
      :key="key"
    >
      <img :src="value.src" />
      <div class="bunga-flower-item__content">
        <h2>{{ value.name }}</h2>
        <p>
          所需水滴：
          <span>{{ flowersStore.flowers[key] }}</span>
        </p>
        <el-button @click="setExchangeValue(key, flowersStore.flowers[key])">
          设置兑换值
        </el-button>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { setFlowerConfig } from '@/api/grow/model'
import { FlowerVO } from '@/api/grow/model/type'
import useFlowersStore from '@/store/modules/flowers'

import xcj_seed from '@/assets/flower_icons/xcj_seed.png'
import xcj_sprout from '@/assets/flower_icons/xcj_sprout.png'
import xcj_bloom from '@/assets/flower_icons/xcj_bloom.png'
import xcj_fruit from '@/assets/flower_icons/xcj_fruit.png'
import bmh_seed from '@/assets/flower_icons/bmh_seed.png'
import bmh_sprout from '@/assets/flower_icons/bmh_sprout.png'
import bmh_bloom from '@/assets/flower_icons/bmh_bloom.jpg'
import bmh_fruit from '@/assets/flower_icons/bmh_fruit.png'
import xhh_seed from '@/assets/flower_icons/xhh_seed.png'
import xhh_sprout from '@/assets/flower_icons/xhh_sprout.png'
import xhh_bloom from '@/assets/flower_icons/xhh_bloom.png'
import xhh_fruit from '@/assets/flower_icons/xhh_fruit.png'

const flowersStore = useFlowersStore()

const flowers: Record<
  keyof FlowerVO,
  {
    src: string
    name: string
  }
> = {
  xcjSeed: {
    src: xcj_seed,
    name: '小雏菊种子',
  },
  xcjSprout: {
    src: xcj_sprout,
    name: '小雏菊发芽',
  },
  xcjBloom: {
    src: xcj_bloom,
    name: '小雏菊开花',
  },
  xcjFruit: {
    src: xcj_fruit,
    name: '小雏菊结果',
  },
  bmhSeed: {
    src: bmh_seed,
    name: '白梅花种子',
  },
  bmhSprout: {
    src: bmh_sprout,
    name: '白梅花发芽',
  },
  bmhBloom: {
    src: bmh_bloom,
    name: '白梅花开花',
  },
  bmhFruit: {
    src: bmh_fruit,
    name: '白梅花结果',
  },
  xhhSeed: {
    src: xhh_seed,
    name: '西红花种子',
  },
  xhhSprout: {
    src: xhh_sprout,
    name: '西红花发芽',
  },
  xhhBloom: {
    src: xhh_bloom,
    name: '西红花开花',
  },
  xhhFruit: {
    src: xhh_fruit,
    name: '西红花结果',
  },
}

const loading = ref<boolean>(false)

const setExchangeValue = (key: keyof FlowerVO, num: number) => {
  ElMessageBox.prompt('请输入兑换值', '设置兑换值', {
    inputPlaceholder: '请输入数量',
    inputValue: String(num),
    confirmButtonText: '确 认',
    cancelButtonText: '取 消',
    inputPattern: /^[1-9]*[1-9][0-9]*$/,
    inputErrorMessage: '请输入数字',
  })
    .then(async ({ value }) => {
      loading.value = true
      try {
        await setFlowerConfig({ key, value: Number(value) })
        ElMessage.success('设置成功')
        flowersStore.setFlowers(key, Number(value))
      } finally {
        loading.value = false
      }
    })
    .catch(() => {})
}
</script>

<style scoped lang="scss">
@include b(flower) {
  position: relative;
  margin: auto;
  max-width: 1200px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  user-select: none;

  @include b(flower-item) {
    width: 260px;
    position: relative;
    border-radius: 8px;
    margin: 20px;
    padding: 20px;
    box-shadow: var(--el-box-shadow);

    > img {
      display: block;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      margin: auto;
      -webkit-user-drag: none;
    }

    @include e(content) {
      text-align: center;
      > h2 {
        font-size: 28px;
        margin-top: 10px;
        color: var(--aside-menu-background);
      }

      > p {
        margin: 10px 0;
        font-size: 16px;
        color: #ccc;

        > span {
          font-size: 32px;
          font-weight: 900;
          color: #67c23a;
        }
      }
    }
  }
}
</style>
